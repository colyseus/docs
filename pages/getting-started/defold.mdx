import { defold } from "../../components/icons/platforms"
import { Callout } from 'nextra/components'
import { DevicesIcon } from '@primer/octicons-react'

# Defold Engine

The Colyseus SDK for Defold supports all major platforms, including:

- HTML5,
- iOS,
- Android
- Native (Mac, and Windows.)

## Install package

From your `game.project` file, add the following Dependencies to your project:

```txt copy
https://github.com/colyseus/colyseus-defold/archive/0.17.zip
```

```txt copy
https://github.com/defold/extension-websocket/archive/4.2.1.zip
```

Now, select **Project** â–¸ **Fetch Libraries** to update library dependencies. Two folders with the library names should appear in your Defold project, indicating the libraries have been imported correctly.

<Callout type="info">
    Read more about [Setting up library dependencies](https://defold.com/manuals/libraries/#setting-up-library-dependencies) on Defold documentation.
</Callout>

## SDK Example Project

The [colyseus-defold](https://github.com/colyseus/colyseus-defold) repository contains a raw example project that demonstrates the SDK features. To run the example:

1. Clone the repository: `git clone https://github.com/colyseus/colyseus-defold.git`
2. Open the project in Defold Editor

### Running the test server locally

To run the test server locally, you will need to run the following commands in your terminal:

```sh filename="Terminal"
git clone https://github.com/colyseus/sdks-test-server
cd sdks-test-server
npm install
npm start
```

<Callout type="info">
    You can see the source code for the test server [here](https://github.com/colyseus/sdks-test-server).
</Callout>

You should be able to see the server running at `http://localhost:2567`, and the example project will be able to connect to it.

## SDK API

Navigate to the [<DevicesIcon/> Client SDK](/sdk) for API Reference, and select the **Lua (Defold)** tab.

## FAQ

### Defold Editor is not opening the project!

If you placed your server directory inside the Defold project directory, the Defold Editor might fail to load the project. You can fix this by adding the server directory to the `.defignore` file.

```txt filename=".defignore"
/server
```

### "I can't connect to the local server!"

When running on localhost, make sure you don't have any service running on port
80, otherwise the client won't connect into the specified port number.

Alternatively, you can bind the Colyseus server to port 80.

**WSL2 Users**

When running the colyseus server inside WSL2, you won't be able to use `localhost` as the hostname.
You'll need to get the WSL2 machine's IP by using `wsl hostname -I` and use that IP.

### "`reconnect()` is not working on iOS!"

If you lock your phone, all WebSocket connections will be closed. You can call `reconnect()` to reestablish the session, which needs a workaround for iOS:

```lua
function window_callback(self, event, data)
    if event == window.WINDOW_EVENT_FOCUS_GAINED then
        -- iOS workaround to re-active WebSocket connection after phone is unlocked
        room:send("whatever")
    end
end

window.set_listener(window_callback)
```
